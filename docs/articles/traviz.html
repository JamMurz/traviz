<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>traviz: Part 1 • traviz</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="traviz: Part 1">
<meta property="og:description" content="Start here to learn how to use traviz. traviz is a package to meaningfully analyze and visualize trajectory data. This package inherits   from sf and the previous trajectories package aiming to bring a modern approach to analyzing and visualizing trajectory data in R. 
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">traviz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/traviz.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/traviz2.html">traviz: Part 2</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JamMurz/traviz/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="traviz_files/header-attrs-2.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>traviz: Part 1</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JamMurz/traviz/blob/master/vignettes/traviz.Rmd"><code>vignettes/traviz.Rmd</code></a></small>
      <div class="hidden name"><code>traviz.Rmd</code></div>

    </div>

    
    
<p>traviz is a package to meaningfully analyze and visualize trajectories in multiple ways. To showcase some of the features of traviz, we’ll use <a href="https://envirocar.org/?lng=en">enviroCar</a> trajectory data in Muenster, Germany. To collect enviroCar data, the <a href="https://github.com/enviroCar/envirocar-py">envirocar-py</a> package was used. Keep in mind traviz is not limited to vehicular trajectory data only and can work with all types of trajectory data.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">traviz</span>)
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</span>
<span class="co">#&gt; Loading required package: trajectories</span>
<span class="co">#&gt; Loading required package: tidyverse</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 1.3.0 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.2     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.0.1     ✓ dplyr   1.0.0</span>
<span class="co">#&gt; ✓ tidyr   1.1.0     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   1.3.1     ✓ forcats 0.5.0</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">#&gt; Loading required package: spacetime</span>
<span class="co">#&gt; Loading required package: Rcpp</span></pre></body></html></div>
<div id="traviz-approaches-to-trajectories-point-analysis-or-overall-line-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#traviz-approaches-to-trajectories-point-analysis-or-overall-line-analysis" class="anchor"></a>traviz approaches to trajectories: point analysis or overall line analysis</h2>
<p>traviz offers two approaches to dealing with trajectory data. The trajectory can either be analyzed as a whole geometry with the complete line or the trajectory can be analyzed point by point. The point by point approach will be showcased in this vignette.</p>
</div>
<div id="dataset-envirocar-sampled-data" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset-envirocar-sampled-data" class="anchor"></a>Dataset: enviroCar sampled data</h2>
<p>To explore the basics of working with trajectory data in traviz, we’ll use the enviroCar data included in the package. This is included as ‘ec.trj’. The dataset consists of:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ec</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"/home/john/Desktop/traviz/data/tracks.csv"</span>,<span class="kw">header</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">check.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">ec</span>[<span class="fl">1</span>,]
<span class="co">#&gt;                         id                time</span>
<span class="co">#&gt; 1 5eb7582c65b80c5d6be6b013 2020-05-09T23:45:27</span>
<span class="co">#&gt;                                     geometry Calculated.MAF.value</span>
<span class="co">#&gt; 1 POINT (7.619238953523779 51.9746148909074)             10.74542</span>
<span class="co">#&gt;   Calculated.MAF.unit Intake.Pressure.value Intake.Pressure.unit CO2.value</span>
<span class="co">#&gt; 1                 g/s                    53                  kPa    8.3008</span>
<span class="co">#&gt;   CO2.unit Intake.Temperature.value Intake.Temperature.unit GPS.VDOP.value</span>
<span class="co">#&gt; 1     kg/h                       27                       c            0.8</span>
<span class="co">#&gt;   GPS.VDOP.unit GPS.Accuracy.value GPS.Accuracy.unit Consumption.value</span>
<span class="co">#&gt; 1     precision                  2                 %          3.532256</span>
<span class="co">#&gt;   Consumption.unit GPS.Bearing.value GPS.Bearing.unit GPS.Speed.value</span>
<span class="co">#&gt; 1              l/h          265.7585              deg        52.06206</span>
<span class="co">#&gt;   GPS.Speed.unit Engine.Load.value Engine.Load.unit Speed.value Speed.unit</span>
<span class="co">#&gt; 1           km/h          45.88235                %          52       km/h</span>
<span class="co">#&gt;   GPS.HDOP.value GPS.HDOP.unit Throttle.Position.value Throttle.Position.unit</span>
<span class="co">#&gt; 1      0.5177532     precision                      17                      %</span>
<span class="co">#&gt;   Rpm.value Rpm.unit GPS.PDOP.value GPS.PDOP.unit GPS.Altitude.value</span>
<span class="co">#&gt; 1  1371.601    u/min      0.9177532     precision                101</span>
<span class="co">#&gt;   GPS.Altitude.unit                 track.id track.length          track.begin</span>
<span class="co">#&gt; 1                 m 5eb7582c65b80c5d6be6b011     169.3725 2020-05-09T23:45:27Z</span>
<span class="co">#&gt;              track.end sensor.type sensor.engineDisplacement sensor.model</span>
<span class="co">#&gt; 1 2020-05-10T01:22:21Z         car                      1798      Caliber</span>
<span class="co">#&gt;                  sensor.id sensor.fuelType sensor.constructionYear</span>
<span class="co">#&gt; 1 58395f40e4b0a979d45bd61b        gasoline                    2007</span>
<span class="co">#&gt;   sensor.manufacturer track.appVersion track.touVersion</span>
<span class="co">#&gt; 1               Dodge                                  </span>
<span class="co">#&gt;   O2.Lambda.Voltage.ER.value O2.Lambda.Voltage.ER.unit MAF.value MAF.unit</span>
<span class="co">#&gt; 1                         NA                                  NA         </span>
<span class="co">#&gt;   O2.Lambda.Voltage.value O2.Lambda.Voltage.unit</span>
<span class="co">#&gt; 1                      NA</span></pre></body></html></div>
<p>enviroCar trajectory data contains geographic data with geometry points in sf format, a unique identifier for each track, time stamps, and data measurements at those timestamps.</p>
</div>
<div id="approach-one-point-data-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#approach-one-point-data-analysis" class="anchor"></a>Approach one: point data analysis</h2>
<p>We begin by making sure the imported data is in a readable format for traviz. To do this we make first make some minor modifications to the csv and using the ‘geodata_to_sf’ function to convert the data to sf.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ec</span>$<span class="no">time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"T"</span>, <span class="st">" "</span>, <span class="no">ec</span>$<span class="no">time</span>)
<span class="no">trajectories</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/geodata_to_sf.html">geodata_to_sf</a></span>(<span class="no">ec</span>, <span class="st">"track.id"</span>)
<span class="no">trajectories</span> <span class="kw">=</span> <span class="no">trajectories</span>[<span class="fl">43</span>:<span class="fl">63</span>,]
<span class="no">trajectories_unnested</span> <span class="kw">=</span> <span class="no">trajectories</span> <span class="kw">%&gt;%</span> <span class="no">unnest</span> <span class="co">#remove nesting for value analysis</span>
<span class="co">#&gt; Warning: `cols` is now required when using unnest().</span>
<span class="co">#&gt; Please use `cols = c(data, geometry)`</span></pre></body></html></div>
<p>For speed we will only use 20 trajectories. The data is now ready to use and we can begin expirementing with traviz’s methods for individual point analysis. Clear ggplot visualization of the trajectories (with normal lonlat projection) is now possible:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">trajectories</span>) + <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">track.id</span>)) + <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>)</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r">#Note: legend is hidden to reduce clutter</pre></body></html></div>
<p>Point data analysis is now possible</p>
<div id="raster-data" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-data" class="anchor"></a>Raster data</h3>
<p>traviz can rasterize data to a desired resolution and provide visualization of this data for a value. We will take a look at the speed values of cars in this subset of trajectories:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'raster'</span>
<span class="co">#&gt; The following object is masked from 'package:traviz':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     distance</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     select</span>
<span class="co">#&gt; The following object is masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     extract</span>
<span class="no">rastered_trajectories</span> <span class="kw">=</span> <span class="fu"><a href="../reference/sf_to_rasterize.html">sf_to_rasterize</a></span>(<span class="no">trajectories_unnested</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="st">'Speed.value'</span>, <span class="kw">resolution</span> <span class="kw">=</span> <span class="fl">.0007</span>)
<span class="co">#&gt; Warning in proj4string(x): CRS object has comment, which is lost in output</span>
<span class="no">rastered_trajectories</span>
<span class="co">#&gt; class      : RasterLayer </span>
<span class="co">#&gt; dimensions : 58, 114, 6612  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution : 7e-04, 7e-04  (x, y)</span>
<span class="co">#&gt; extent     : 7.586874, 7.666674, 51.93411, 51.97471  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source     : memory</span>
<span class="co">#&gt; names      : layer </span>
<span class="co">#&gt; values     : 0, 79  (min, max)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">rastered_trajectories</span>)</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="heatmap-of-trajectory-values" class="section level3">
<h3 class="hasAnchor">
<a href="#heatmap-of-trajectory-values" class="anchor"></a>Heatmap of trajectory values</h3>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/density_heatmap.html">density_heatmap</a></span>(<span class="no">trajectories_unnested</span>, <span class="st">'Speed.value'</span>, <span class="kw">resolution</span> <span class="kw">=</span> <span class="fl">.0007</span>)
<span class="co">#&gt; Warning in proj4string(x): CRS object has comment, which is lost in output</span>
<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded</span>
<span class="co">#&gt; datum Unknown based on WGS84 ellipsoid in CRS definition</span>
<span class="co">#&gt; Registered S3 method overwritten by 'spatstat':</span>
<span class="co">#&gt;   method     from</span>
<span class="co">#&gt;   print.boxx cli</span></pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-6-1.png" width="700"> It appears that cars seem to move faster at the bottom left and bottom right of this map of Muenster based off the heatmap density.</p>
</div>
<div id="k-means-clustering" class="section level3">
<h3 class="hasAnchor">
<a href="#k-means-clustering" class="anchor"></a>k-means clustering</h3>
<p>traviz supports k-mean clustering. In future development, there will be point by point clustering.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">clusters</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cluster_traj.html">cluster_traj</a></span>(<span class="no">trajectories</span>, <span class="kw">num_clusters</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">clusters</span>)</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
<div id="aggregation-tools-for-point-data" class="section level2">
<h2 class="hasAnchor">
<a href="#aggregation-tools-for-point-data" class="anchor"></a>Aggregation tools for point data</h2>
<p>traviz supports multiple forms of trajectory aggregation. Below is a showcase of a couple of aggregation methods.</p>
<div id="raster-aggregation" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-aggregation" class="anchor"></a>Raster aggregation:</h3>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="fu"><a href="../reference/aggregate_raster_region.html">aggregate_raster_region</a></span>(<span class="no">rastered_trajectories</span>, <span class="kw">xmin</span> <span class="kw">=</span> <span class="fl">7.62</span>, <span class="kw">xmax</span> <span class="kw">=</span> <span class="fl">7.63</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="fl">51.93</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="fl">51.94</span>))</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div id="trajectories-by-day-and-by-hour" class="section level3">
<h3 class="hasAnchor">
<a href="#trajectories-by-day-and-by-hour" class="anchor"></a>Trajectories by day and by hour:</h3>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_day.html">plot_day</a></span>(<span class="no">trajectories_unnested</span>)</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_hour.html">plot_hour</a></span>(<span class="no">trajectories_unnested</span>)</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
</div>
<div id="trajectory-density-by-day-and-by-hour" class="section level3">
<h3 class="hasAnchor">
<a href="#trajectory-density-by-day-and-by-hour" class="anchor"></a>Trajectory density by day and by hour:</h3>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_day_density.html">plot_day_density</a></span>(<span class="kw">df</span> <span class="kw">=</span> <span class="no">trajectories_unnested</span>)</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_hour_density.html">plot_hour_density</a></span>(<span class="kw">df</span> <span class="kw">=</span> <span class="no">trajectories_unnested</span>)</pre></body></html></div>
<p><img src="traviz_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Murzaku.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
